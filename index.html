<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Firmeza - Edición Limitada</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;500;600;700&family=Oswald:wght@300;400;500;600;700&family=Montserrat:wght@300;400;500;600;700;800&display=swap');
    .font-signature { font-family: 'Playfair Display', serif; }
    .font-main { font-family: 'Inter', sans-serif; }
    .font-oswald { font-family: 'Oswald', sans-serif; }
    .font-montserrat { font-family: 'Montserrat', sans-serif; }

    .crown-animation { animation: crownGlow 3s ease-in-out infinite alternate; }
    @keyframes crownGlow { 0% { filter: drop-shadow(0 0 10px rgba(255,255,255,.3)); } 100% { filter: drop-shadow(0 0 20px rgba(255,255,255,.8)); } }
    .float-animation { animation: float 4s ease-in-out infinite; }
    @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    .fade-in-up { opacity:0; transform: translateY(30px); transition: all .8s ease; }
    .fade-in-up.visible { opacity:1; transform: translateY(0); }
    .particle { position:absolute; width:4px; height:4px; background: rgba(255,255,255,.6); border-radius:50%; pointer-events:none; }

    .text-gradient { background: linear-gradient(45deg, #ffffff, #cccccc); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }

    /* Destello blanco para el pill cuando es válido */
    .glow-white {
      color: #fff !important;
      border-color: #fff !important;
      animation: glowPulse 1s ease-in-out infinite alternate;
    }
    @keyframes glowPulse {
      from { text-shadow: 0 0 5px rgba(255,255,255,.6), 0 0 10px rgba(255,255,255,.4); }
      to   { text-shadow: 0 0 20px rgba(255,255,255,1), 0 0 30px rgba(255,255,255,.8); }
    }
  </style>
</head>
<body class="bg-black text-white font-main overflow-x-hidden">

  <!-- Partículas -->
  <div id="particles-container" class="fixed inset-0 pointer-events-none z-0"></div>

  <!-- HERO -->
  <section class="relative min-h-screen flex flex-col items-center justify-center px-6 z-10">
    <div class="relative flex flex-col items-center justify-center w-full">

      <!-- Corona de fondo (arriba) -->
      <div class="absolute inset-0 flex items-start justify-center z-10 pointer-events-none">
        <img src="./Corona.svg" alt="Corona"
             class="w-[28rem] h-[28rem] crown-animation object-contain scale-[2.2] -translate-y-24" />
      </div>

      <!-- Gorra -->
      <div class="relative z-20 mb-8 float-animation">
        <img src="./gorra-front.png" alt="Gorra Firmeza"
             class="w-80 h-80 object-contain scale-[1.5]" id="hero-cap" />
      </div>

      <!-- Logo -->
      <div class="relative z-40 fade-in-up" id="brand-name">
        <img src="./Firmeza.svg" alt="Firmeza" class="h-32 md:h-32 object-contain scale-[1.5]" />
      </div>

      <!-- AUDIO oculto -->
      <audio id="anthem" src="./Hipocresia.mp3" preload="auto" playsinline></audio>

    </div>
  </section>

  <!-- CERTIFICADO -->
  <section class="relative py-20 px-4 z-10">
    <div class="max-w-4xl mx-auto text-center">

      <div class="fade-in-up" id="certificate-title">
        <h2 class="text-5xl md:text-5xl font-bold mb-8 tracking-wider font-oswald">CERTIFICADO DE ORIGINALIDAD</h2>
      </div>

      <div class="fade-in-up" id="certificate-text">
        <p class="text-lg md:text-xl text-gray-300 leading-relaxed max-w-3xl mx-auto mb-12 font-montserrat">
          Esta gorra pertenece al  
          <span class="font-bold text-white tracking-wide glow-white">
            primer drop de gorras exclusivas
          </span> de Grupo Firmeza. 
          Cada pieza ha sido diseñada y fabricada a lujo de detalle. <br><br>
          En este momento 
          <span>estás verificando la originalidad de pieza número:</span>
        </p>
      </div>

      <!-- Número de edición + estado -->
      <div class="fade-in-up" id="edition-number">
        <div class="text-8xl md:text-9xl font-bold mb-2 text-gradient  glow-white tracking-wide font-oswald" id="number-counter">—/—</div>
        <div id="verify-pill" class="inline-block mt-2 px-3 py-1 text-sm rounded-full border border-white/20 text-white/90 font-montserrat">
          Verificando...
        </div>
      </div>

      <!-- CTA -->
      <div class="fade-in-up mt-10" id="cta-button">
        <a href="https://atom.bio/grupofirmezaoficial" target="_blank" rel="noopener"
           class="inline-block rounded-md bg-white text-black px-12 py-4 text-xl font-semibold tracking-wider hover:bg-gray-200 transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl font-oswald"
           id="listen-btn">
          ¡ESCÚCHANOS AQUÍ!
        </a>
      </div>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="py-12 text-center text-gray-500 z-10 relative">
    <div class="fade-in-up" id="footer">
      <p class="font-oswald text-2xl mb-2">GRUPO FIRMEZA  X  LS HATS</p>
      <p class="text-sm font-montserrat">Edición Limitada © 2025</p>
      <p class="text-sm font-montserrat">Cada gorra de este drop es único, cualquier intento de copia será demandado por derechos de autor</p>
    </div>
  </footer>

  <!-- Partículas / efectos ligeros -->
  <script>
    // Fade-in
    const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -50px 0px' };
    const observer = new IntersectionObserver((entries)=>{ entries.forEach(e=>{ if(e.isIntersecting) e.target.classList.add('visible'); }); }, observerOptions);
    document.querySelectorAll('.fade-in-up').forEach(el=>observer.observe(el));

    // Partículas
    function createParticles(){
      const container = document.getElementById('particles-container'); const n=50;
      for(let i=0;i<n;i++){ const p=document.createElement('div'); p.classList.add('particle');
        p.style.left=Math.random()*100+'%'; p.style.top=Math.random()*100+'%'; p.style.animationDelay=Math.random()*4+'s';
        p.style.animation = `particleFloat ${3+Math.random()*4}s ease-in-out infinite, particleFade ${2+Math.random()*3}s ease-in-out infinite alternate`;
        container.appendChild(p);
      }
    }
    const style=document.createElement('style'); style.textContent=`
      @keyframes particleFloat{0%,100%{transform:translateY(0) translateX(0)}25%{transform:translateY(-20px) translateX(10px)}50%{transform:translateY(-10px) translateX(-5px)}75%{transform:translateY(-30px) translateX(-10px)}}
      @keyframes particleFade{0%{opacity:.2}100%{opacity:.8}}
      @keyframes cursorFade{to{opacity:0; transform:scale(3)}}
    `; document.head.appendChild(style);

    // Cursor sparkle
    document.addEventListener('mousemove',(e)=>{ const c=document.createElement('div'); c.className='fixed w-1 h-1 bg-white rounded-full pointer-events-none z-50 opacity-50';
      c.style.left=e.clientX+'px'; c.style.top=e.clientY+'px'; c.style.animation='cursorFade .5s ease-out forwards'; document.body.appendChild(c);
      setTimeout(()=>c.remove(),500);
    });

    window.addEventListener('load', ()=>{ createParticles(); });
  </script>

  <!-- Audio: autoplay (mute) + desbloqueo primer toque + pausar/reanudar -->
  <script>
    (function setupAutoplay(){
      const params = new URLSearchParams(location.search);
      const wantPlay = params.get('play') === '1';
      const audio = document.getElementById('anthem');
      if (!audio) return;

      audio.muted = true;
      if (wantPlay) {
        audio.play().catch(()=>{});
      }

      // Primer toque desbloquea
      const unlock = () => {
        audio.muted = false;
        audio.play().catch(()=>{});
        document.removeEventListener('click', unlock);
        document.removeEventListener('touchstart', unlock);
      };
      document.addEventListener('click', unlock, { once: true });
      document.addEventListener('touchstart', unlock, { once: true });

      // Pausar/reanudar según visibilidad
      document.addEventListener("visibilitychange", () => {
        if (document.hidden) {
          if (!audio.paused) audio.pause();
        } else {
          audio.play().catch(()=>{});
        }
      });
    })();
  </script>

  <!-- Hook para el botón (Android/Chrome seguro) -->
  <script>
    (function hookButtonPlay(){
      const btn   = document.getElementById('listen-btn');
      const audio = document.getElementById('anthem');
      if (!btn || !audio) return;

      btn.addEventListener('click', (e) => {
        e.preventDefault();
        audio.muted = false;
        audio.play().catch(()=>{});
        const url = btn.getAttribute('href');
        setTimeout(() => {
          window.open(url, '_blank', 'noopener');
        }, 150);
      }, { passive: false });
    })();
  </script>

  <!-- Verificación NFC / Contador dinámico -->
  <script>
    (async function certificado(){
      const TOTAL = 15;
      const $ = s => document.querySelector(s);
      const params = new URLSearchParams(location.search);

      const idStr = (params.get('id') || '').trim();
      const k     = (params.get('k')  || '').trim();

      const $counter = $('#number-counter');
      const $pill    = $('#verify-pill');
      const $hero    = $('#hero-cap');
      const audio    = document.getElementById('anthem');

      if (!idStr || !k) {
        $counter.textContent = '—/—';
        $pill.textContent = 'Faltan parámetros (?id=&k=)';
        $pill.className = 'inline-block mt-2 px-3 py-1 text-sm rounded-full border text-yellow-300 font-montserrat';
        return;
      }

      let pretty = '—/—';
      const m = idStr.match(/^serialnumber(\d+)\s*\/\s*(\d+)-/i);
      if (m) { pretty = `${m[1]}/${m[2]}`; }
      else   { const n = idStr.match(/(\d+)\s*\/\s*(\d+)/); pretty = n ? `${n[1]}/${n[2]}` : `—/${TOTAL}`; }
      $counter.textContent = pretty;

      try {
        const res = await fetch('./caps.json', { cache: 'no-store' });
        const caps = await res.json();
        const cap = caps.find(c => String(c.id) === idStr);

        if (!cap) {
          $pill.textContent = `No existe el ID: ${idStr}`;
          $pill.className = 'inline-block mt-2 px-3 py-1 text-sm rounded-full border text-red-300 font-montserrat';
          return;
        }

        const ok = (cap.token === k);

        if (ok) {
          $pill.textContent = 'Certificado válido';
          $pill.className = 'inline-block mt-2 px-3 py-1 text-sm rounded-full border font-montserrat glow-white';
          if (audio) { audio.play().catch(()=>{}); }
        } else {
          $pill.textContent = 'Token incorrecto';
          $pill.className = 'inline-block mt-2 px-3 py-1 text-sm rounded-full border text-red-300 font-montserrat';
        }

        const imgPath = cap.image || 'gorra-front.png';
        if ($hero) $hero.src = imgPath;

        document.title = `Firmeza ${pretty} – Certificado`;

      } catch (e) {
        console.error(e);
        $pill.textContent = 'Error cargando caps.json';
        $pill.className = 'inline-block mt-2 px-3 py-1 text-sm rounded-full border text-yellow-300 font-montserrat';
      }
    })();
  </script>

</body>
</html>
